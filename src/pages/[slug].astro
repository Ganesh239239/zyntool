---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

// Import modular components
import CompressTool from '../components/tools/CompressTool.astro';
import ResizeTool from '../components/tools/ResizeTool.astro';
import CropTool from '../components/tools/CropTool.astro';
import WatermarkTool from '../components/tools/WatermarkTool.astro';
import BlurTool from '../components/tools/BlurTool.astro';
import ConvertFromJpgTool from '../components/tools/ConvertFromJpgTool.astro';
import ConvertToJpgTool from '../components/tools/ConvertToJpgTool.astro';
import MemeTool from '../components/tools/MemeTool.astro';
import HtmlToImageTool from '../components/tools/HtmlToImageTool.astro';
import UpscaleTool from '../components/tools/UpscaleTool.astro';
import RemoveBgTool from '../components/tools/RemoveBgTool.astro';
import PhotoEditorTool from '../components/tools/PhotoEditorTool.astro';
import ImageToPdfTool from '../components/tools/ImageToPdfTool.astro';
import PdfToImageTool from '../components/tools/PdfToImageTool.astro';
import OcrTool from '../components/tools/OcrTool.astro';

export async function getStaticPaths() {
  const toolEntries = await getCollection('tools');
  return toolEntries.map(entry => ({ params: { slug: entry.slug || entry.id }, props: { entry } }));
}

const { entry } = Astro.props;
if (!entry) return Astro.redirect('/404');

const toolId = entry.slug || entry.id;
const allTools = await getCollection('tools');
const relatedTools = allTools.filter(t => (t.slug || t.id) !== toolId).slice(0, 6);
const { Content } = await entry.render();

const seoTitle = `${entry.data.title} Online - 100% Free | ZynTool`;
---

<MainLayout title={seoTitle}>
    <!-- COMPACT HERO SECTION -->
    <div class="tool-hero text-white" style={`background: linear-gradient(135deg, ${entry.data.color}, #1a202c);`}>
        <div class="container text-center">
            <span class="badge bg-white text-dark mb-2 px-3 py-1 rounded-pill fw-bold extra-small uppercase tracking-wider">Online Tool</span>
            <h1 class="h2 fw-black mb-1">{entry.data.title}</h1>
            <p class="opacity-75 small mb-0 d-none d-md-block">{entry.data.description}</p>
        </div>
    </div>

    <!-- TIGHTER CONTENT WRAPPER -->
    <div class="container tool-container-fixed pb-4">
        
        <!-- COMPONENT SWITCHER -->
        {toolId === 'compress-image' && <CompressTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'resize-image' && <ResizeTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'crop-image' && <CropTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'watermark-image' && <WatermarkTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'blur-image' && <BlurTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'convert-from-jpg' && <ConvertFromJpgTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'convert-to-jpg' && <ConvertToJpgTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'meme-generator' && <MemeTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'html-to-image' && <HtmlToImageTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'upscale-image' && <UpscaleTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'remove-background' && <RemoveBgTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'photo-editor' && <PhotoEditorTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'image-to-pdf' && <ImageToPdfTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'pdf-to-image' && <PdfToImageTool entry={entry} relatedTools={relatedTools} />}
        {toolId === 'ocr-image' && <OcrTool entry={entry} relatedTools={relatedTools} />}

        <!-- INSTRUCTIONS -->
        <div class="content-section mt-5 pt-4 border-top">
            <article class="prose mx-auto">
                <Content />
            </article>
        </div>
    </div>
</MainLayout>

<style>
    .fw-black { font-weight: 800; }
    .extra-small { font-size: 0.65rem; }
    
    .tool-hero { 
        padding: 40px 0 70px; /* Reduced for utility feel */
        position: relative;
        z-index: 1; 
    }

    .tool-container-fixed { 
        margin-top: -45px; 
        position: relative; 
        z-index: 10; 
    }

    .prose { 
        max-width: 800px; 
        font-size: 0.95rem;
        color: #4b5563;
        line-height: 1.7;
    }
</style>
