---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

// Import modular components
import CompressTool from '../components/tools/CompressTool.astro';
import ResizeTool from '../components/tools/ResizeTool.astro';
import CropTool from '../components/tools/CropTool.astro';
import WatermarkTool from '../components/tools/WatermarkTool.astro';
import BlurTool from '../components/tools/BlurTool.astro';
import ConvertFromJpgTool from '../components/tools/ConvertFromJpgTool.astro';
import ConvertToJpgTool from '../components/tools/ConvertToJpgTool.astro';
import MemeTool from '../components/tools/MemeTool.astro';
import HtmlToImageTool from '../components/tools/HtmlToImageTool.astro';
import UpscaleTool from '../components/tools/UpscaleTool.astro';
import RemoveBgTool from '../components/tools/RemoveBgTool.astro';
import PhotoEditorTool from '../components/tools/PhotoEditorTool.astro';
import ImageToPdfTool from '../components/tools/ImageToPdfTool.astro';
import PdfToImageTool from '../components/tools/PdfToImageTool.astro';
import OcrTool from '../components/tools/OcrTool.astro';

export async function getStaticPaths() {
  const toolEntries = await getCollection('tools');
  return toolEntries.map(entry => ({ params: { slug: entry.slug || entry.id }, props: { entry } }));
}

const { entry } = Astro.props;
if (!entry) return Astro.redirect('/404');

const toolId = entry.slug || entry.id;
const allTools = await getCollection('tools');
const relatedTools = allTools.filter(t => (t.slug || t.id) !== toolId).slice(0, 6);
const { Content } = await entry.render();

const seoTitle = `${entry.data.title} Online - 100% Free | ZynTool`;
---

<MainLayout title={seoTitle} description={seoDesc}>
    <!-- APP-STYLE UTILITY HEADER (Developer Mindset) -->
    <div class="app-header-bar border-bottom bg-white">
        <div class="container d-flex align-items-center justify-content-between h-100">
            <!-- Left: Breadcrumbs -->
            <nav aria-label="breadcrumb">
                <ol class="breadcrumb m-0">
                    <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Home</a></li>
                    <li class="breadcrumb-item small-text active" aria-current="page">{entry.data.title}</li>
                </ol>
            </nav>

            <!-- Right: Technical Info (Optional) -->
            <div class="d-none d-md-flex align-items-center gap-3">
                <span class="status-indicator">
                    <span class="pulse-dot"></span> Online & Secure
                </span>
            </div>
        </div>
    </div>

    <!-- MAIN WORKSPACE: Now sits much higher on the page -->
    <div class="container tool-workspace-container py-4">
        
        <!-- TOOL LOGIC SWITCHER -->
        <div class="mb-5">
            {toolId === 'compress-image' && <CompressTool entry={entry} relatedTools={relatedTools} />}
            <!-- ... rest of your tool switcher ... -->
        </div>

        <!-- TECHNICAL DOCUMENTATION (Hidden in SEO Article) -->
        <div class="content-section pt-5 border-top">
            <header class="mb-4">
                <h2 class="fw-bold h4">Technical Implementation & Guide</h2>
                <p class="text-muted small">How ZynTool processes your data for {entry.data.title}</p>
            </header>
            <article class="prose mx-auto">
                <Content />
            </article>
        </div>
    </div>
</MainLayout>

<style>
    /* --- THE UTILITY BAR SYSTEM --- */
    .app-header-bar {
        height: 56px; /* Strict slim height */
        background-color: #ffffff;
        position: sticky;
        top: 70px; /* Sits right under your main navbar */
        z-index: 100;
    }

    .breadcrumb {
        font-size: 0.85rem;
        font-weight: 500;
    }
    
    .breadcrumb-item + .breadcrumb-item::before {
        content: "â€º";
        font-size: 1.2rem;
        line-height: 1;
        vertical-align: middle;
        color: #cbd5e1;
    }

    .breadcrumb-item.active {
        color: #1e293b;
        font-weight: 700;
    }

    /* Status Indicator Logic */
    .status-indicator {
        font-size: 0.75rem;
        font-weight: 700;
        color: #64748b;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        display: flex;
        align-items: center;
        gap: 8px;
    }

    .pulse-dot {
        width: 8px; height: 8px;
        background-color: #10b981; /* Success Green */
        border-radius: 50%;
        display: inline-block;
        box-shadow: 0 0 0 rgba(16, 185, 129, 0.4);
        animation: pulse 2s infinite;
    }

    @keyframes pulse {
        0% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0.7); }
        70% { box-shadow: 0 0 0 10px rgba(16, 185, 129, 0); }
        100% { box-shadow: 0 0 0 0 rgba(16, 185, 129, 0); }
    }

    /* Workspace container - No more negative margins! */
    .tool-workspace-container {
        position: relative;
        z-index: 10;
    }

    .prose { 
        max-width: 850px; 
        color: #475569;
        font-size: 0.95rem;
    }

    @media (max-width: 767px) {
        .app-header-bar { height: 48px; }
        .breadcrumb { font-size: 0.75rem; }
    }
</style>
