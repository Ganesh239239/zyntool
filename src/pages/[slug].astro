---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

// Import all modular tool components
import CompressTool from '../components/tools/CompressTool.astro';
import ResizeTool from '../components/tools/ResizeTool.astro';
import CropTool from '../components/tools/CropTool.astro';
import WatermarkTool from '../components/tools/WatermarkTool.astro';
import BlurTool from '../components/tools/BlurTool.astro';
import ConvertFromJpgTool from '../components/tools/ConvertFromJpgTool.astro';
import ConvertToJpgTool from '../components/tools/ConvertToJpgTool.astro';
import MemeTool from '../components/tools/MemeTool.astro';
import HtmlToImageTool from '../components/tools/HtmlToImageTool.astro';
import UpscaleTool from '../components/tools/UpscaleTool.astro';
import RemoveBgTool from '../components/tools/RemoveBgTool.astro';
import PhotoEditorTool from '../components/tools/PhotoEditorTool.astro';
import ImageToPdfTool from '../components/tools/ImageToPdfTool.astro';
import PdfToImageTool from '../components/tools/PdfToImageTool.astro';
import RotateTool from '../components/tools/RotateTool.astro';
import OcrTool from '../components/tools/OcrTool.astro';


export async function getStaticPaths() {
  const toolEntries = await getCollection('tools');
  if (!toolEntries || toolEntries.length === 0) return [];
  return toolEntries.map(entry => ({
    params: { slug: entry.slug || entry.id }, 
    props: { entry },
  }));
}

const { entry } = Astro.props;

if (!entry) {
  return Astro.redirect('/404');
}

const allTools = await getCollection('tools');
const toolId = entry.slug || entry.id;
const relatedTools = allTools
  .filter(t => (t.slug || t.id) !== toolId)
  .slice(0, 6);

const { Content } = await entry.render();

const seoTitle = `${entry.data.title} Online - 100% Free & Fast | ZynTool`;
const seoDesc = `${entry.data.description} Process your images locally in your browser for 100% privacy. No registration required.`;
---

<MainLayout title={seoTitle} description={seoDesc}>
    
    <!-- MINIMALIST HEADER (Matching your image) -->
    <div class="tool-header-wrapper">
        <div class="container text-center">
            <h1 class="tool-main-title">{entry.data.title}</h1>
            <p class="tool-main-desc">
                Compress <span class="text-primary">JPG</span>, <span class="text-primary">PNG</span>, <span class="text-primary">SVG</span> or <span class="text-primary">GIF</span> with the best quality and compression.<br/>
                Reduce the filesize of your images at once.
            </p>
        </div>
    </div>

    <!-- MAIN WORKSPACE -->
    <div class="container pb-5">
        <div class="tool-mount-point">
            {toolId === 'compress-image' && <CompressTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'resize-image' && <ResizeTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'crop-image' && <CropTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'watermark-image' && <WatermarkTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'blur-image' && <BlurTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'convert-from-jpg' && <ConvertFromJpgTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'convert-to-jpg' && <ConvertToJpgTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'meme-generator' && <MemeTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'html-to-image' && <HtmlToImageTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'upscale-image' && <UpscaleTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'remove-background' && <RemoveBgTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'photo-editor' && <PhotoEditorTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'image-to-pdf' && <ImageToPdfTool entry={entry} relatedTools={relatedTools} />}
            {toolId === 'pdf-to-image' && <PdfToImageTool entry={entry} relatedTools={relatedTools} />} 
            {toolId === 'rotate-image' && <RotateTool entry={entry} relatedTools={relatedTools} />} 
            {toolId === 'ocr-image' && <OcrTool entry={entry} relatedTools={relatedTools} />}
        </div>

        <!-- SEO CONTENT SECTION -->
        <div class="content-section mt-5 pt-5 border-top">
            <article class="prose mx-auto">
                <Content />
            </article>
        </div>
    </div>
</MainLayout>

<style>
    /* --- iLoveIMG Style Header --- */
    .tool-header-wrapper {
        padding: 60px 0 40px;
        background-color: #f3f3f7; /* Light gray background from image */
    }

    .tool-main-title {
        font-size: 48px;
        font-weight: 800;
        color: #33333b;
        margin-bottom: 15px;
        letter-spacing: -1px;
    }

    .tool-main-desc {
        font-size: 20px;
        color: #47474f;
        line-height: 1.5;
        max-width: 800px;
        margin: 0 auto;
    }

    .tool-mount-point {
        margin-top: 20px;
    }

    /* SEO Article Styling */
    .prose { 
        max-width: 800px; 
        color: #4a5568; 
        line-height: 1.8; 
    }
    .prose :global(h2), .prose :global(h3) { 
        color: #1a202c; 
        font-weight: 800; 
        margin-top: 2.5rem; 
        margin-bottom: 1rem; 
    }

    @media (max-width: 767px) {
        .tool-main-title { font-size: 32px; }
        .tool-main-desc { font-size: 16px; }
        .tool-header-wrapper { padding: 40px 0 20px; }
    }
</style>
