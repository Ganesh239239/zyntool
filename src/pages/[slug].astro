---
import { getCollection } from 'astro:content';
import MainLayout from '../layouts/MainLayout.astro';

// Import React Tool Components
import CompressTool from '../components/tools/CompressTool.jsx';
import CropTool from '../components/tools/CropTool.jsx';
// Import other tools as .jsx files here...

export async function getStaticPaths() {
  const toolEntries = await getCollection('tools');
  if (!toolEntries || toolEntries.length === 0) return [];
  return toolEntries.map(entry => ({
    params: { slug: entry.slug || entry.id }, 
    props: { entry },
  }));
}

const { entry } = Astro.props;
if (!entry) return Astro.redirect('/404');

const allTools = await getCollection('tools');
const toolId = entry.slug || entry.id;
const relatedTools = allTools
  .filter(t => (t.slug || t.id) !== toolId)
  .slice(0, 6);

const { Content } = await entry.render();

// SEO Strategy
const seoTitle = entry.data.seo_title || `${entry.data.title} Online - 100% Free | ZynTool`;
const seoDesc = entry.data.seo_description || `Fast and private ${entry.data.title} tool.`;
---

<MainLayout title={seoTitle} description={seoDesc}>
    <!-- RESTORED HERO SECTION (Simple & Attractive) -->
    <div class="w-full py-12 md:py-20 text-white" style={`background: linear-gradient(135deg, ${entry.data.color}, #1a202c);`}>
        <div class="container mx-auto px-4 text-center">
            <span class="inline-block bg-white/20 backdrop-blur-sm text-white text-[10px] font-black uppercase tracking-[2px] px-3 py-1 rounded-full mb-4 border border-white/30">
                Online Tool
            </span>
            <h1 class="text-4xl md:text-6xl font-black mb-3 tracking-tight">{entry.data.title}</h1>
            <p class="text-white/80 text-lg md:text-xl max-w-2xl mx-auto font-medium">{entry.data.description}</p>
        </div>
    </div>

    <!-- MAIN WORKSPACE CONTAINER -->
    <div class="container mx-auto px-4 -mt-10 pb-20 relative z-10">
        
        <div class="mb-16">
            <!-- REACT ISLANDS -->
            {toolId === 'compress-image' && <CompressTool client:load entry={entry} relatedTools={relatedTools} />}
            {toolId === 'crop-image' && <CropTool client:load entry={entry} relatedTools={relatedTools} />}
            
            <!-- Fallback for other tools -->
            {!['compress-image', 'crop-image'].includes(toolId) && (
                <div class="bg-white rounded-[32px] p-20 shadow-xl border border-slate-100 text-center">
                    <div class="w-16 h-16 bg-slate-50 rounded-full flex items-center justify-center mx-auto mb-4 text-slate-300">
                        <i class={`fa-solid ${entry.data.icon} fa-2x`}></i>
                    </div>
                    <h2 class="text-xl font-bold text-slate-800">Switching to React Engine</h2>
                    <p class="text-slate-400">Please wait while we optimize this tool...</p>
                </div>
            )}
        </div>

        <!-- SEO CONTENT SECTION -->
        <div class="max-w-4xl mx-auto border-t border-slate-200 pt-16">
            <article class="prose prose-slate prose-headings:font-black prose-h2:text-3xl prose-p:text-slate-600 prose-p:leading-relaxed max-w-none">
                <Content />
            </article>
        </div>
    </div>
</MainLayout>
