let img=null;document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const preview=document.getElementById('previewArea');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');input.addEventListener('change',e=>{const file=e.target.files[0];if(!file)return;const reader=new FileReader();reader.onload=e=>{img=new Image();img.onload=()=>{options.classList.add('active');preview.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-group"><label>Top Text:</label><input type="text" id="top" placeholder="TOP TEXT"></div><div class="option-group"><label>Bottom Text:</label><input type="text" id="bottom" placeholder="BOTTOM TEXT"></div>`;updatePreview();['top','bottom'].forEach(id=>document.getElementById(id).addEventListener('input',updatePreview))};img.src=e.target.result};reader.readAsDataURL(file)});function updatePreview(){if(!img)return;const canvas=document.createElement('canvas');canvas.className='preview-image';canvas.width=img.width;canvas.height=img.height;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0);const top=document.getElementById('top').value.toUpperCase();const bottom=document.getElementById('bottom').value.toUpperCase();ctx.font='bold 48px Impact';ctx.fillStyle='white';ctx.strokeStyle='black';ctx.lineWidth=3;ctx.textAlign='center';if(top){ctx.strokeText(top,canvas.width/2,70);ctx.fillText(top,canvas.width/2,70)}if(bottom){ctx.strokeText(bottom,canvas.width/2,canvas.height-30);ctx.fillText(bottom,canvas.width/2,canvas.height-30)}document.getElementById('previewContainer').innerHTML='';document.getElementById('previewContainer').appendChild(canvas)}processBtn.addEventListener('click',()=>{if(!img)return;loading.classList.add('active');setTimeout(()=>{const canvas=document.getElementById('previewContainer').querySelector('canvas');canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='meme.jpg';a.click();loading.classList.remove('active');alert('Done!')},'image/jpeg',0.9)},500)})});