let img=null;document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const preview=document.getElementById('previewArea');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');input.addEventListener('change',e=>{const file=e.target.files[0];if(!file||!file.type.startsWith('image/'))return;const reader=new FileReader();reader.onload=e=>{img=new Image();img.onload=()=>{options.classList.add('active');preview.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-row"><div class="option-group"><label>X:</label><input type="number" id="x" value="0" min="0"></div><div class="option-group"><label>Y:</label><input type="number" id="y" value="0" min="0"></div></div><div class="option-row"><div class="option-group"><label>Width:</label><input type="number" id="w" value="200" min="1"></div><div class="option-group"><label>Height:</label><input type="number" id="h" value="200" min="1"></div></div>`;const canvas=document.createElement('canvas');canvas.className='preview-image';canvas.width=img.width;canvas.height=img.height;canvas.getContext('2d').drawImage(img,0,0);document.getElementById('previewContainer').innerHTML='';document.getElementById('previewContainer').appendChild(canvas)};img.src=e.target.result};reader.readAsDataURL(file)});processBtn.addEventListener('click',()=>{if(!img)return;loading.classList.add('active');const x=parseInt(document.getElementById('x').value)||0;const y=parseInt(document.getElementById('y').value)||0;const w=parseInt(document.getElementById('w').value)||200;const h=parseInt(document.getElementById('h').value)||200;setTimeout(()=>{const canvas=document.createElement('canvas');canvas.width=w;canvas.height=h;canvas.getContext('2d').drawImage(img,x,y,w,h,0,0,w,h);canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download='cropped.jpg';a.click();loading.classList.remove('active');alert('Done!')},'image/jpeg',0.9)},500)})});