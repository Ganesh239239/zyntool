let files=[];document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');const resetBtn=document.getElementById('resetBtn');input.addEventListener('change',e=>{files=Array.from(e.target.files).filter(f=>f.type.startsWith('image/'));if(files.length){options.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-group"><label>Quality (%):</label><input type="range" id="quality" min="10" max="100" value="80" style="width:100%"><p style="text-align:center;font-weight:600;color:#e74c3c"><span id="qval">80</span>%</p></div>`;document.getElementById('quality').addEventListener('input',e=>{document.getElementById('qval').textContent=e.target.value})}});processBtn.addEventListener('click',()=>{if(!files.length){alert('Select images');return}loading.classList.add('active');const q=parseInt(document.getElementById('quality').value)/100;setTimeout(()=>{files.forEach((file,i)=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const canvas=document.createElement('canvas');canvas.width=img.width;canvas.height=img.height;canvas.getContext('2d').drawImage(img,0,0);canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=file.name.replace(/\.[^/.]+$/,'')+'_compressed.jpg';setTimeout(()=>a.click(),i*200);if(i===files.length-1)setTimeout(()=>{loading.classList.remove('active');alert('Done!')},files.length*200+500)},'image/jpeg',q)};img.src=e.target.result};reader.readAsDataURL(file)})},500)});resetBtn.addEventListener('click',()=>{files=[];input.value='';options.classList.remove('active')})});