let uploadedFiles=[];document.addEventListener('DOMContentLoaded',function(){const fileInput=document.getElementById('fileInput');const uploadArea=document.getElementById('uploadArea');const toolOptions=document.getElementById('toolOptions');const previewArea=document.getElementById('previewArea');const loading=document.getElementById('loading');const compressBtn=document.getElementById('compressBtn');const resetBtn=document.getElementById('resetBtn');const qualitySlider=document.getElementById('qualitySlider');const qualityValue=document.getElementById('qualityValue');fileInput.addEventListener('change',handleFiles);uploadArea.addEventListener('dragover',(e)=>{e.preventDefault();uploadArea.classList.add('dragover')});uploadArea.addEventListener('dragleave',()=>{uploadArea.classList.remove('dragover')});uploadArea.addEventListener('drop',(e)=>{e.preventDefault();uploadArea.classList.remove('dragover');handleFiles({target:{files:e.dataTransfer.files}})});qualitySlider.addEventListener('input',function(){qualityValue.textContent=this.value});function handleFiles(e){const files=Array.from(e.target.files);if(files.length===0)return;uploadedFiles=files.filter(file=>file.type.startsWith('image/'));if(uploadedFiles.length===0){alert('Please select valid image files');return}toolOptions.classList.add('active');previewArea.classList.add('active');displayFileList()}function displayFileList(){const fileList=document.getElementById('fileList');fileList.innerHTML='<h4 style="margin-bottom:1rem">Selected Files ('+uploadedFiles.length+')</h4>';uploadedFiles.forEach((file,index)=>{const fileItem=document.createElement('div');fileItem.className='file-item';fileItem.innerHTML=`<div class="file-info"><span class="file-icon">üñºÔ∏è</span><div class="file-details"><h4>${file.name}</h4><p>Original: ${(file.size/1024).toFixed(2)} KB</p></div></div><button class="remove-file" onclick="removeFile(${index})">Remove</button>`;fileList.appendChild(fileItem)})}window.removeFile=function(index){uploadedFiles.splice(index,1);if(uploadedFiles.length===0){toolOptions.classList.remove('active');previewArea.classList.remove('active');fileInput.value=''}else{displayFileList()}};compressBtn.addEventListener('click',compressImages);resetBtn.addEventListener('click',function(){uploadedFiles=[];fileInput.value='';toolOptions.classList.remove('active');previewArea.classList.remove('active')});function compressImages(){if(uploadedFiles.length===0){alert('Please select images first');return}loading.classList.add('active');const quality=parseFloat(qualitySlider.value)/100;let processed=0;uploadedFiles.forEach((file,index)=>{const reader=new FileReader();reader.onload=function(e){const img=new Image();img.onload=function(){const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');canvas.width=img.width;canvas.height=img.height;ctx.drawImage(img,0,0);canvas.toBlob(function(blob){const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=file.name.replace(/\.[^/.]+$/,'')+'_compressed.jpg';setTimeout(()=>{a.click();URL.revokeObjectURL(url)},index*200);processed++;if(processed===uploadedFiles.length){loading.classList.remove('active');alert('Images compressed successfully!')}},'image/jpeg',quality)};img.src=e.target.result};reader.readAsDataURL(file)})}});