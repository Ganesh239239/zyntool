let files=[];document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');input.addEventListener('change',e=>{files=Array.from(e.target.files).filter(f=>f.type.startsWith('image/'));if(files.length){options.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-group"><label>Quality:</label><input type="range" id="q" min="60" max="100" value="90" style="width:100%"><p style="text-align:center"><span id="qv">90</span>%</p></div>`;document.getElementById('q').addEventListener('input',e=>{document.getElementById('qv').textContent=e.target.value})}});processBtn.addEventListener('click',()=>{if(!files.length)return;loading.classList.add('active');const q=parseInt(document.getElementById('q').value)/100;setTimeout(()=>{files.forEach((file,i)=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const canvas=document.createElement('canvas');canvas.width=img.width;canvas.height=img.height;const ctx=canvas.getContext('2d');ctx.fillStyle='#fff';ctx.fillRect(0,0,canvas.width,canvas.height);ctx.drawImage(img,0,0);canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=file.name.replace(/\.[^/.]+$/,'')+'.jpg';setTimeout(()=>a.click(),i*200);if(i===files.length-1)setTimeout(()=>{loading.classList.remove('active');alert('Done!')},files.length*200+500)},'image/jpeg',q)};img.src=e.target.result};reader.readAsDataURL(file)})},500)})});