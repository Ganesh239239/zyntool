let files=[];document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');input.addEventListener('change',e=>{files=Array.from(e.target.files).filter(f=>f.type.startsWith('image/'));if(files.length){options.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-group"><label>Text:</label><input type="text" id="text" value="Â© Your Name"></div><div class="option-group"><label>Position:</label><select id="pos"><option value="br">Bottom Right</option><option value="bl">Bottom Left</option><option value="tr">Top Right</option><option value="tl">Top Left</option></select></div>`}});processBtn.addEventListener('click',()=>{if(!files.length)return;loading.classList.add('active');const text=document.getElementById('text').value;const pos=document.getElementById('pos').value;setTimeout(()=>{files.forEach((file,i)=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const canvas=document.createElement('canvas');canvas.width=img.width;canvas.height=img.height;const ctx=canvas.getContext('2d');ctx.drawImage(img,0,0);ctx.font='bold 40px Arial';ctx.fillStyle='rgba(255,255,255,0.7)';ctx.strokeStyle='rgba(0,0,0,0.5)';ctx.lineWidth=2;const w=ctx.measureText(text).width;const p=20;let x,y;if(pos==='br'){x=canvas.width-w-p;y=canvas.height-p}else if(pos==='bl'){x=p;y=canvas.height-p}else if(pos==='tr'){x=canvas.width-w-p;y=60}else{x=p;y=60}ctx.strokeText(text,x,y);ctx.fillText(text,x,y);canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=file.name.replace(/\.[^/.]+$/,'')+'_watermarked.jpg';setTimeout(()=>a.click(),i*200);if(i===files.length-1)setTimeout(()=>{loading.classList.remove('active');alert('Done!')},files.length*200+500)},'image/jpeg',0.9)};img.src=e.target.result};reader.readAsDataURL(file)})},500)})});