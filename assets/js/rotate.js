// Rotate IMAGE - Button Style (iLoveIMG)
const uploadZone=document.getElementById('upload-zone'),selectBtn=document.getElementById('select-btn'),fileInput=document.getElementById('file-input'),workArea=document.getElementById('work-area'),loadingOverlay=document.getElementById('loading-overlay'),thumbnailImg=document.getElementById('thumbnail-img'),imageName=document.getElementById('image-name'),controlsContent=document.getElementById('controls-content'),processBtn=document.getElementById('process-btn'),downloadBtn=document.getElementById('download-btn');let currentImage=null,originalFile=null,processedBlob=null,currentRotation=0,flipH=false,flipV=false;controlsContent.innerHTML=`<h3>Rotate Options</h3><div class="control-item"><label class="control-label">Quick Rotate</label><div class="button-group"><button class="btn-secondary" id="rotate-90">↻ 90°</button><button class="btn-secondary" id="rotate-180">↻ 180°</button><button class="btn-secondary" id="rotate-270">↻ 270°</button></div></div><div class="control-item"><label class="control-label">Flip</label><div class="button-group" style="grid-template-columns: 1fr 1fr;"><button class="btn-secondary" id="flip-horizontal">⇄ Horizontal</button><button class="btn-secondary" id="flip-vertical">⇅ Vertical</button></div></div><div class="control-item"><div class="info-box"><p>Current rotation: <strong><span id="rotation-display">0°</span></strong></p><p>Flip H: <span id="flip-h-display">No</span> | Flip V: <span id="flip-v-display">No</span></p></div></div>`;processBtn.textContent='Apply Rotation';selectBtn.addEventListener('click',e=>{e.stopPropagation();fileInput.click()});fileInput.addEventListener('change',e=>{if(e.target.files.length>0)handleFile(e.target.files[0])});uploadZone.addEventListener('dragover',e=>{e.preventDefault();uploadZone.classList.add('dragover')});uploadZone.addEventListener('dragleave',()=>uploadZone.classList.remove('dragover'));uploadZone.addEventListener('drop',e=>{e.preventDefault();uploadZone.classList.remove('dragover');if(e.dataTransfer.files.length>0)handleFile(e.dataTransfer.files[0])});setTimeout(()=>{document.getElementById('rotate-90').addEventListener('click',()=>{currentRotation=(currentRotation+90)%360;updatePreview()});document.getElementById('rotate-180').addEventListener('click',()=>{currentRotation=(currentRotation+180)%360;updatePreview()});document.getElementById('rotate-270').addEventListener('click',()=>{currentRotation=(currentRotation+270)%360;updatePreview()});document.getElementById('flip-horizontal').addEventListener('click',()=>{flipH=!flipH;updatePreview()});document.getElementById('flip-vertical').addEventListener('click',()=>{flipV=!flipV;updatePreview()})},100);processBtn.addEventListener('click',rotateImage);downloadBtn.addEventListener('click',downloadImage);async function handleFile(file){if(!file.type.startsWith('image/')){alert('Please select an image file');return}originalFile=file;loadingOverlay.style.display='flex';try{const img=await loadImage(file);currentImage=img;const thumbnail=await createThumbnail(img,300);thumbnailImg.src=thumbnail;imageName.textContent=file.name;currentRotation=0;flipH=false;flipV=false;updatePreview();uploadZone.style.display='none';workArea.style.display='grid';loadingOverlay.style.display='none';downloadBtn.style.display='none'}catch(error){alert('Error loading image');loadingOverlay.style.display='none'}}function updatePreview(){document.getElementById('rotation-display').textContent=currentRotation+'°';document.getElementById('flip-h-display').textContent=flipH?'Yes':'No';document.getElementById('flip-v-display').textContent=flipV?'Yes':'No';let transform=`rotate(${currentRotation}deg)`;if(flipH)transform+=` scaleX(-1)`;if(flipV)transform+=` scaleY(-1)`;thumbnailImg.style.transform=transform;thumbnailImg.style.transition='transform 0.3s ease'}async function rotateImage(){processBtn.disabled=true;processBtn.textContent='Processing...';loadingOverlay.style.display='flex';setTimeout(()=>{const canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');let width=currentImage.width,height=currentImage.height;if(currentRotation===90||currentRotation===270){canvas.width=height;canvas.height=width}else{canvas.width=width;canvas.height=height}ctx.translate(canvas.width/2,canvas.height/2);ctx.rotate(currentRotation*Math.PI/180);if(flipH)ctx.scale(-1,1);if(flipV)ctx.scale(1,-1);ctx.drawImage(currentImage,-width/2,-height/2,width,height);canvas.toBlob(blob=>{processedBlob=blob;downloadBtn.style.display='block';processBtn.textContent='Apply Rotation';processBtn.disabled=false;loadingOverlay.style.display='none'},'image/jpeg',0.9)},600)}function downloadImage(){if(processedBlob){const url=URL.createObjectURL(processedBlob),a=document.createElement('a');a.href=url;a.download=`rotated-${Date.now()}.jpg`;a.click();URL.revokeObjectURL(url)}}function loadImage(file){return new Promise((resolve,reject)=>{const img=new Image();img.onload=()=>resolve(img);img.onerror=reject;img.src=URL.createObjectURL(file)})}function createThumbnail(img,maxSize){return new Promise(resolve=>{const canvas=document.createElement('canvas'),ctx=canvas.getContext('2d');let width=img.width,height=img.height;if(width>height){if(width>maxSize){height=height*maxSize/width;width=maxSize}}else{if(height>maxSize){width=width*maxSize/height;height=maxSize}}canvas.width=width;canvas.height=height;ctx.drawImage(img,0,0,width,height);resolve(canvas.toDataURL('image/jpeg',0.9))})}