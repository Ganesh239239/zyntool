let files=[];document.addEventListener('DOMContentLoaded',()=>{const input=document.getElementById('fileInput');const options=document.getElementById('toolOptions');const loading=document.getElementById('loading');const processBtn=document.getElementById('processBtn');input.addEventListener('change',e=>{files=Array.from(e.target.files).filter(f=>f.type.startsWith('image/'));if(files.length){options.classList.add('active');document.getElementById('options-content').innerHTML=`<div class="option-group"><label>Angle:</label><select id="angle"><option value="90">90° Right</option><option value="180">180°</option><option value="270">270° Right</option></select></div>`}});processBtn.addEventListener('click',()=>{if(!files.length)return;loading.classList.add('active');const angle=parseInt(document.getElementById('angle').value);setTimeout(()=>{files.forEach((file,i)=>{const reader=new FileReader();reader.onload=e=>{const img=new Image();img.onload=()=>{const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');if(angle===90||angle===270){canvas.width=img.height;canvas.height=img.width}else{canvas.width=img.width;canvas.height=img.height}ctx.translate(canvas.width/2,canvas.height/2);ctx.rotate((angle*Math.PI)/180);ctx.drawImage(img,-img.width/2,-img.height/2);canvas.toBlob(blob=>{const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=file.name.replace(/\.[^/.]+$/,'')+'_rotated.jpg';setTimeout(()=>a.click(),i*200);if(i===files.length-1)setTimeout(()=>{loading.classList.remove('active');alert('Done!')},files.length*200+500)},'image/jpeg',0.9)};img.src=e.target.result};reader.readAsDataURL(file)})},500)})});