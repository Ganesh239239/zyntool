let uploadedFiles=[];let processedImages=[];document.addEventListener('DOMContentLoaded',function(){const fileInput=document.getElementById('fileInput');const uploadArea=document.getElementById('uploadArea');const toolOptions=document.getElementById('toolOptions');const previewArea=document.getElementById('previewArea');const loading=document.getElementById('loading');const resizeBtn=document.getElementById('resizeBtn');const resetBtn=document.getElementById('resetBtn');const resizeMethod=document.getElementById('resizeMethod');const widthInput=document.getElementById('widthInput');const heightInput=document.getElementById('heightInput');let originalWidth,originalHeight;fileInput.addEventListener('change',handleFiles);uploadArea.addEventListener('dragover',(e)=>{e.preventDefault();uploadArea.classList.add('dragover')});uploadArea.addEventListener('dragleave',()=>{uploadArea.classList.remove('dragover')});uploadArea.addEventListener('drop',(e)=>{e.preventDefault();uploadArea.classList.remove('dragover');handleFiles({target:{files:e.dataTransfer.files}})});resizeMethod.addEventListener('change',function(){if(this.value==='pixels'){document.getElementById('pixelOptions').style.display='block';document.getElementById('percentageOptions').style.display='none'}else{document.getElementById('pixelOptions').style.display='none';document.getElementById('percentageOptions').style.display='block'}});widthInput.addEventListener('input',function(){if(document.getElementById('maintainAspect').checked&&originalWidth&&originalHeight){const ratio=originalHeight/originalWidth;heightInput.value=Math.round(this.value*ratio)}});heightInput.addEventListener('input',function(){if(document.getElementById('maintainAspect').checked&&originalWidth&&originalHeight){const ratio=originalWidth/originalHeight;widthInput.value=Math.round(this.value*ratio)}});function handleFiles(e){const files=Array.from(e.target.files);if(files.length===0)return;uploadedFiles=files.filter(file=>file.type.startsWith('image/'));if(uploadedFiles.length===0){alert('Please select valid image files');return}toolOptions.classList.add('active');previewArea.classList.add('active');const reader=new FileReader();reader.onload=function(e){const img=new Image();img.onload=function(){originalWidth=img.width;originalHeight=img.height;widthInput.value=img.width;heightInput.value=img.height;document.getElementById('previewImage').src=e.target.result};img.src=e.target.result};reader.readAsDataURL(uploadedFiles[0]);displayFileList()}function displayFileList(){const fileList=document.getElementById('fileList');fileList.innerHTML='<h4 style="margin-bottom:1rem">Selected Files ('+uploadedFiles.length+')</h4>';uploadedFiles.forEach((file,index)=>{const fileItem=document.createElement('div');fileItem.className='file-item';fileItem.innerHTML=`<div class="file-info"><span class="file-icon">üñºÔ∏è</span><div class="file-details"><h4>${file.name}</h4><p>${(file.size/1024).toFixed(2)} KB</p></div></div><button class="remove-file" onclick="removeFile(${index})">Remove</button>`;fileList.appendChild(fileItem)})}window.removeFile=function(index){uploadedFiles.splice(index,1);if(uploadedFiles.length===0){toolOptions.classList.remove('active');previewArea.classList.remove('active');fileInput.value=''}else{displayFileList()}};resizeBtn.addEventListener('click',resizeImages);resetBtn.addEventListener('click',function(){uploadedFiles=[];processedImages=[];fileInput.value='';toolOptions.classList.remove('active');previewArea.classList.remove('active')});function resizeImages(){if(uploadedFiles.length===0){alert('Please select images first');return}loading.classList.add('active');processedImages=[];const method=resizeMethod.value;let targetWidth,targetHeight,scale;if(method==='pixels'){targetWidth=parseInt(widthInput.value);targetHeight=parseInt(heightInput.value);if(!targetWidth||!targetHeight){alert('Please enter valid dimensions');loading.classList.remove('active');return}}else{scale=parseFloat(document.getElementById('scaleInput').value)/100;if(!scale||scale<=0){alert('Please enter valid scale');loading.classList.remove('active');return}}let processed=0;uploadedFiles.forEach((file,index)=>{const reader=new FileReader();reader.onload=function(e){const img=new Image();img.onload=function(){const canvas=document.createElement('canvas');const ctx=canvas.getContext('2d');if(method==='pixels'){canvas.width=targetWidth;canvas.height=targetHeight}else{canvas.width=img.width*scale;canvas.height=img.height*scale}ctx.drawImage(img,0,0,canvas.width,canvas.height);canvas.toBlob(function(blob){const url=URL.createObjectURL(blob);const a=document.createElement('a');a.href=url;a.download=file.name.replace(/\.[^/.]+$/,'')+'_resized.jpg';setTimeout(()=>{a.click();URL.revokeObjectURL(url)},index*200);processed++;if(processed===uploadedFiles.length){loading.classList.remove('active');alert('Images resized successfully!')}},'image/jpeg',0.9)};img.src=e.target.result};reader.readAsDataURL(file)})}});